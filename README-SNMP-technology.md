### 简单网络管理协议SNMP
#### 网络管理的基本概念
+ `网络管理包括对硬件、软件和人力的使用、综合与协调，以便对网络资源进行监视、测试、配置、分析、评价和控制，这样就能以合理的价格满足网络的一些需求，如实时运行性能、服务质量等，网络管理简称为网管`；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-130.jpg) 

|网络管理模型中的主要构件|说明|
|------|------|
|管理站|又称为管理器，是整个网络管理系统的核心；它通常是个有着良好图形界面的高性能工作站，并由网络管理员直接操作和控制，所有向被管设备发送的命令都是从管理站发出的，管理站的所在部门也常称为网络运行中心NOC，管理站中的关键构件是管理程序|
|被管设备|被管设备可以是主机、路由器、打印机、集线器、网桥或调制解调器等，被管设备有时可称为网络元素或网元|
|网络管理代理程序|被管设备上运行的程序；代理程序在管理程序的命令和控制下，在被管设备上运行本地程序的行动|
|网络管理协议|简称网管协议|
|简单网络管理协议SNMP|简单网络管理协议SNMP中的管理程序和代理程序按客户-服务器方式工作，管理程序运行SNMP客户程序，而代理程序运行SNMP服务器程序，在被管对象上运行的SNMP服务器程序不停的监听来自管理站的SNMP客户程序的请求，一旦发现了，就立即返回管理站所需要的信息，或执行某个动作|

+ 网络管理的基本原理：`若要管理某个对象，就必然会给该对象添加一些软件或硬件，但这种添加必须对原有对象的影响尽量小些`；

|SNMP网络管理的三个部分|说明|
|-------|-------|
|SNMP|定义了管理站和代理之间所交换的分组格式，所交换的分组包含各代理中的对象名(变量)及其状态(值)，SNMP负责读取和改变这些数值|
|管理信息结构SMI|定义了命名对象和定义对象类型(包括范围和长度)的通用规则，以及把对象和对象的值进行编码的规则；如 int|
|管理信息库MIB|给每个对象命名，并定义对象的类型 如int count|

+ `SNMP`按照`SMI`定义的规则，存储、改变和解释这些已由`MIB`说明的对象的值；`SMI`建立规则，`MIB`对变量进行说明，而`SNMP`完成网管的动作；

### 管理信息结构SMI
+ `管理信息结构SMI`的功能应当有三个，即规定：一、被管对象应怎么命名；二、用来存储被管对象的数据类型有哪些种；三、在网络上传送的管理数据应如何编码；
#### 被管对象的命名
+ `SMI`规定，所有的被管对象都必须处在`对象命名树`上；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-131.jpg)  

#### 被管对象的数据类型
+ `SMI`把数据类型分为两大类：`简单类型`和`结构化类型`；

|类型|大小|说明|
|------|------|------|
|INTEGER|4字节|在-2^31到2^31-1之间的整数|
|Integer32|4字节|和INTEGER相同|
|Unsigned32|4字节|在0到2^32-1之间的无符号数|
|OCTET STRING|可变|不超过65535字节长的字符串|
|OBJECT IDENTIFIER|可变|对象标识符|
|IPAddress|4字节|由4个整数组成的IP地址|
|Counter32|4字节|可从0增加到2^32的整数，当它到达最大值时就返回到0|
|TimeTicks|4字节|记录时间的计数值，以1/100秒为单位|
|BITS|`---`|比特串|
|Opaque|可变|不解释的串|
|sequence|可变|相当于C语言的struct|
|sequence of|可变|相当于C语言的array|

#### 编码方法
+ `SMI`使用ASN.1制定的`基本编码规则BER`，进行数据的编码，ASN.1把所有的数据元素都表示为`T-L-V`三个字段组成的序列，`T`字段`定义数据的类型`，`L`字段`定义V字段的长度`，而`V`字段`定义数据的值`；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-132.jpg) 

|字段|说明|
|------|------|
|T字段|又叫做标记字段，T字段又再分为以下三个子字段：类别(2位)：通用类(00)即ASN.1定义的类型；应用类(01)即SMI定义的类型；上下文类(10)即上下文所定义的类型；专用类(11)保留为特定厂商定义的类型；格式(1位)：指出数据类型的种类，简单数据类型(0)，结构化数据类型(1)；编号(5位)用来标志不同的数据类型|
|L字段|有叫做长度字段(单字节或多字节)|
|V字段|有叫做值字段，用于定义数据元素的值|

### 管理信息库MIB
+ 所谓`管理信息`就是指在因特网的网管框架中`被管对象的集合`，`被管对象`必须维持可供管理程序读写的若干控制和状态信息，管理程序就使用MIB中这些信息的`值`对网络进行管理(如读取或重新设置这些值)，只有在MIB中的对象才是`SNMP`所能够管理的；
### SNMP的协议数据单元和报文
+ `SNMP`的操作只有两种基本的管理功能，即`读操作；用Get报文来检测各被管对象的状况`和`读操作；用Set报文来改变各被管对象的状况`；`SNMP`使用无连接的`UDP`，因此在网络上传送`SNMP`报文的开销较小，在运行代理程序的服务器端用`熟知端口161`来接收`Get`和`Set`报文和发送响应报文(与熟知端口通信的客户端使用临时端口)，但运行管理程序的客户端则使用`熟知端口162`来接收来自各代理的`trap报文`；

|SNMP报文的组成部分|说明|
|------|------|
|版本|现在版本号为3|
|首部|包括版本标识、最大报文长度、报文标志(1字节)，其中的每一位定义安全类型或其他信息|
|安全参数|用来产生报文摘要|
|SNMP报文的数据部分||

![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-133.jpg) 

|字段|含义|
|------|------|
|请求标识符|由管理进程设置的4个字节整数值，代理进程在发送响应报文时也要返回此请求标识符，由于管理进程可同时向许多代理发出请求读取变量值的报文，因此设置了请求标识符可使管理进程能够识别返回的响应是对应于哪一个请求报文|
|差错状态|在请求报文中，这个字段是零，当代理进程响应时，就填入0~18中的一个数字，如后面说明0：noError(一切正常)；1：tooBig(代理无法把回答装入到一个SNMP报文之中)；2：noSuchName(操作指明了一个不存在的变量)；3：badValue(无效值或无效语法)|
|差错索引|在请求报文中，这个字段是零，当代理进程响应时，若出现noSuchName、badValue、readOnly的差错，代理进程就设置一个整数，指明有差错的变量在变量列表中的偏移|
|变量绑定|指明一个或多个变量的名和对应的值，在请求报文中，变量的值应忽略(类型是NULL)|
