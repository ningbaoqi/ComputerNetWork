### 下一代网际协议IPv6(IPng)
#### 解决IP地址耗尽的根本措施
+ 解决IP地址耗尽的根本措施就是采用具有更大地址空间的新版本的IP，即`IPv6`；
#### IPv6的基本首部
+ IPv6仍支持无连接的传送，但将协议数据单元PDU称为`分组`，而不是IPv4的数据报；

|IPv6主要变化|说明|
|------|------|
|更大的地址空间|128位表示|
|扩展的地址层次结构||
|灵活的首部格式|IPv6数据报的首部和IPv4的并不兼容，IPv6定义了许多可选的扩展首部，不仅可提供比IPv4更过的功能，而且提高路由器的处理效率，这是因为路由器对扩展首部不进行处理(除逐跳扩展首部外)|
|改进的选项|IPv6允许数据报包含有选项的控制信息，因而可以包含一些新的选项，但IPv6的首部长度是固定的，其选项放在有效载荷中；IPv4所规定的选项是固定不变的，其选项放在首部的可变部分|
|允许协议继续扩充||
|支持即插即用|即自动配置|
|支持资源的预分配||
|IPv6首部改为8字节对齐|即首部长度必须是8字节的整数倍，原来的IPv4首部是4字节对齐|

+ IPv6数据报在`基本首部`的后面允许`有零个或多个扩展首部`，再后面是数据，所有的扩展首部并不算是IPv6数据报的首部，所有的扩展首部和数据结合起来叫做数据报的`有效载荷`或`净负荷`；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-270.jpg)
+ 在基本首部后面是`有效载荷`，它包括运输层的`数据`和`可能选用的扩展首部`；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-271.jpg)

|IPv6对首部中的某些字段的更改|
|------|
|取消了首部长度字段，因为它的首部长度是固定的(40字节)|
|取消了服务类型字段，因为优先级和流标号字段合起来实现了服务类型字段的功能|
|取消了总长度字段，改用有效载荷长度字段|
|取消了标识、标志和片偏移字段，因为这些功能已包含在分片扩展首部中|
|把TTL字段改称为跳数限制字段，但作用是一样的|
|取消了协议字段，改用下一个首部字段|
|取消了检验和字段，这样就加快了路由器处理数据报的速度|
|取消了选项字段，而用扩展首部来实现选项功能|

#### IPv6基本首部中各字段的作用

|字段|作用|
|------|------|
|版本|说明了协议的版本，对IPv6该字段是6|
|通信量类|这是为了区分不同的IPv6数据报的类型或优先级|
|流标号|IPv6的一个新的机制是支持资源预分配，并且允许路由器把每一个数据报与一个给定的资源分配相联系，流就是互联网上从特定源点到特定终点(单播或多播)的一系列数据报(如实时音频或视频传输)，而在这个流所经过的路径上的路由器都保证指明的服务质量，所有属于同一个流的数据报都具有相同的流标号，因此，流标号对实时音频/视频数据的传送特别有用，对于传统的电子邮件或非实时数据，流标号则没有用处，把它设置为0即可|
|有效载荷长度|它指明IPv6数据报除基本首部以外的字节数|
|下一个首部|它相当于IPv4的协议字段和可选字段，当IPv6数据报没有扩展首部时，下一个首部字段的作用和IPv4的协议字段一样，它的值指出了基本首部后面的数据应交付IP层上面的哪一个高级协议如TCP，当出现扩展首部时，下一个首部字段的值就标识后面第一个扩展首部的类型|
|跳数限制|用来防止数据报在网络中无限期的存在，源点在每个数据报发出时即设定某个跳数限制，每个路由器在转发数据报时，要先把跳数限制字段中的值减1，当跳数限制的值为零时，就要把这个数据报丢失|
|源地址|是数据报的发送端的IP地址|
|目的地址|是数据报的接收端的IP地址|

### IPv6的扩展首部
#### 扩展首部及下一个首部字段
+ `IPv6`把原来IPv4首部中选项的功能都放在`扩展首部`中，并把`扩展首部`留给路径两端的源点和终点的主机来处理，而数据报途中经过的`路由器都不处理这些扩展首部(只有一个首部例外即逐跳选项扩展首部)`这样就`大大提高了路由器的处理效率`；有六种扩展首部：`逐跳选项`、`路由选择`、`分片`、`鉴别`、`封装安全有效载荷`、`目的站选项`；`扩展首部`的第一个字段都是8位的`下一个首部`字段；此字段的值指出了在该扩展首部后面的字段是什么；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-272.jpg)
#### 扩展首部举例
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-273.jpg)

|分片首部的字段|说明|
|------|------|
|下一个首部|指明紧接着这个扩展首部的下一个首部|
|保留|为今后使用|
|片偏移|指明本数据报片在原来的数据报中的偏移量，以8个字节为表示单位，可见每个数据报片的长度必须是8个字节的整数|
|M|M=1表示后面还有数据报片，M=0表示这已经是最后一个数据报片|
|标识符|由源点产生的、用来唯一的标志数据报的一个32位数，每产生一个新数据报，就把这个标识符加1|

### IPv6的地址空间
#### 地址的类型与地址空间

|IPv6的目的地址|说明|
|------|------|
|单播|单播是传统的点对点通信|
|多播|多播是一对多点的通信，数据报发送到一组计算机中的每一个|
|任播|这是IPv6增加的一种类型，任播的终点是一组计算机，但数据报只交付其中的一个，通常是距离最近的一个|

+ 一个用点十进制记法的128位地址`255.255.255.255.255.255.255.255.255.255.255.255.255.255.255.255`，`IPv6`使用`冒号十六进制记法`就变为了`FFFF:FFFF:FFFF:0:FFFF:FFFF:FFFF:FFFF`，在十六进制记法中，允许把数字前面的0省略，十六进制记法可以允许`零压缩`即一连串连续的零可以为一对冒号所取代如`FFFF:0:0:0:0:0:0:FFFF`可以写成`FFFF::FFFF`，在任一地址中只能使用一次`零压缩`；可以结合点十记法：`0:0:0:0:0:0:128.10.2.1`同`::128.10.2.1`；`CIDR`的斜线表示法仍然可用，如`60位的前缀12AB00000000CD3`可以记为`12AB:0:0:CD30::/60`；
#### 特殊地址

|特殊地址|说明|
|------|------|
|未指明地址|这是16字节的全0地址，可缩写为两个冒号::或::/128，这个地址不能用作目的地址，而只能为某个主机当作源地址使用，条件是这个主机还没有配置到一个标准的IP地址|
|环回地址|IPv6的环回地址是0:0:0:0:0:0:0:1(即::1或::1/128)作用和IPv4的环回地址一样|
|基于IPv4地址|这种地址叫做IPv4映射的IPv6地址，它只是把IPv4地址转换为IPv6地址的形式，但是IPv6设备并不是别这种地址|
|本地链路单播地址|连接在这个网络上的主机都可以使用这种本地地址进行通信，但不能和因特网上其他主机通信|
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-274.jpg)
