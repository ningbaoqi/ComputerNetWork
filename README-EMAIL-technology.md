### 电子邮件
+ 电子邮件标准：`简单邮件传送协议SMTP`和`因特网文本报文格式`；由于因特网的`SMTP`只能传送`可打印的7位ASCII码`邮件，后又提出了`通用因特网邮件扩充MIME`，`MIME`在其邮件首部中说明了`邮件的数据类型(如文本、声音、图像、视频等)`，在`MIME`邮件中可同时传送多种类型的数据；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-180.jpg) 

|电子邮件系统的四个组成部分|说明|
|------|------|
|用户代理(User Agent)|就是用户与电子邮件系统的接口，在大多数情况下它就是运行在用户PC中的一个程序，因此用户代理又称为电子邮件客户端软件；用户代理应具有4种功能：一、撰写：给用户提供编辑信件的环境；二、显示：能方便的在计算机屏幕上显示出来信(包括来信附上的声音和图像)；三、处理：处理包括发送邮件和接收邮件；四、通信：发信人在撰写完邮件后，要利用邮件发送协议发送到用户所使用的邮件服务器，收件人在接收邮件时，要使用邮件读取协议从本地邮件服务器接收邮件|
|邮件服务器|邮件服务器需要使用两种不同的协议，一种协议用于用户代理向邮件服务器发送邮件或在邮件服务器之间发送邮件如SMTP协议；而另一种协议用于用户代理从邮件服务器读取邮件，如邮局协议POP3|
|邮件发送协议|如SMTP|
|邮件读取协议|如POP3(该协议是邮局协议的版本3)|

+ 请注意：`SMTP`和`POP3(或IMAP)`都是在`TCP`连接的上面传送邮件，使用`TCP`的目的是为了使邮件的传送成为可靠的；请注意：`邮件不会在因特网中的某个中间邮件服务器落地`；`接收方邮件代理`是`主动`的向接收邮件服务器进行`拉取`的；电子邮件由`信封`和`内容`两部分组成，电子邮件的传输程序根据邮件`信封`上的信息来传送邮件，在邮件的`信封`上，最重要的就是`收件人的地址`，`TCP/IP`体系的电子邮件系统规定`电子邮件地址`的格式为`用户名@邮件服务器的域名`如`1031297081@qq.com`；

### 简单邮件传送协议SMTP
+ `SMTP`规定了`14条命令`和`21种应答信息`，每条命令用几个字母组成，而每一种应答信息一般只有一行信息，由一个3位数字的代码开始，后面附上(也可不附上)很简单的文字说明；`SMTP`传送的邮件是`明文`不利于`保密`；
#### 连接建立
```
发件人的邮件送到发送方邮件服务器的邮件缓存后，SMTP客户就每隔一段时间对邮件缓存扫描一次，如发现有邮件，就使用SMTP的熟知端口号码     25     与接收方邮件服务器的SMTP服务器建立TCP连接


在连接建立后，接收方SMTP服务器要发出     220 Service ready(服务就绪)     然后SMTP客户向SMTP服务器发送     HELO     命令附上发送方的主机名


SMTP服务器若有能力接收邮件，则回答     250 OK     ，表示已准备好接收，若SMTP服务器不可用，则回答      421  Service not available (服务不可用) 


SMTP不使用中间的邮件服务器
```

#### 邮件传送
```

邮件的传送从     MAIL     命令开始，     MAIL     命令后面有发件人的地址，如      MAIL FROM：<1031297081@qq.com>     ，若SMTP服务器已经准备好接收邮件，则回答     250 OK     否则返回一个代码，指出原因如     451(处理时出错)     452(存储空间不够)     500(命令无法识别)等


下面跟着一个或多个     RCPT     命令，取决于把同一个邮件发送给一个或多个收件人，其格式是     RCPT  TO：<收件人地址>     每发送一个      RCPT     命令，都应有相应的信息从SMTP服务器返回，如     250 OK     表示指明的邮件在接收方的系统中，或     550  No such user here(无此用户名)     即不存在此邮箱；RCPT命令的作用就是：先弄清楚接收方系统是否已做好接收邮件的准备，然后才发送邮件


在下面就是     DATA     命令，表示要开始传送邮件的内容了，SMTP服务器返回的信息是：354 Start mail input；end with <CRLF>.<CRLF>  这里  <CRLF>  是回车换行的意思，若不能接收邮件，则返回     421(服务器不可用)     500(命令无法识别)     等，接着SMTP客户就发送邮件的内容，发送完毕后，再发送     <CRLF>.<CRLF>     表示邮件内容结束，实际上在服务器看到的可打印字符只是一个英文的句号，若邮件收到了，则SMTP服务器返回信息     250 OK     或返回差错代码

```

#### 连接释放

```
邮件发送完毕后，SMTP客户应发送      QUIT     命令，SMTP服务器返回的信息是       221(服务关闭)      表示SMTP同意释放TCP连接，邮件传送的全部过程即结束；
```

### 电子邮件的信息格式
+ 一个电子邮件分为`信封`和`内容`两大部分，在标准中只规定了`首部格式`，而对邮件的`主体部分`则让用户自由撰写，用户写好首部后，邮件系统自动的将信封所需要的信息提取出来并写在`信封`上；

|邮件首部关键字|说明|
|------|------|
|To：|后面填写一个或多个收件人的电子邮件地址|
|Subject：|是邮件的主题，它反映了邮件的主要内容|
|Cc：|抄送，意思是留下一个复写副本，表示应给某某人发送一份邮件副本|
|Bcc：|盲复写副本，这是使发件人能将邮件的副本送给某人，但不希望此事为收件人知道，Bcc又称为暗送|
|From：|表示发件人的电子邮件地址|
|Date：|发信日期|
|Reply-To：|即对方回信所用的地址|

### 邮件读取协议POP3和IMAP
+ 现在最常用的`邮件读取协议`有两个：`邮局协议第三个版本POP3`和`网际报文存取协议IMAP`；

|邮件读取协议|说明|
|------|------|
|邮局协议POP|是一个非常简单，但功能有限的邮件存取协议，POP服务器只有在用户键入鉴别信息(用户名和密码)后，才允许对邮箱进行读取；只要用户从POP服务器读取了邮件，POP服务器就把该邮件删除，最后对POP进行了扩展，可以设置POP邮件服务器存放的时间|
|网际报文存取协议IMAP|在使用IMAP时，在用户的PC上运行IMAP客户程序，然后与接收方的邮件服务器上的IMAP服务器程序建立TCP连接，用户在自己的PC上就可以操作邮件服务器的邮箱，就像在本地操纵一样，因此IMAP是一个联机协议；在用户未发出删除邮件的命令之前，IMAP服务器邮箱中的邮件一直保存着；IMAP的缺点是如果用户没有将邮件复制到自己的PC上，则邮件一直是存放在IMAP服务器上的，因此，用户需要经常与IMAP服务器建立连接|

+ 发件人的用户代理向发送方邮件服务器发送邮件，以及发送方邮件服务器向接收方邮件服务器发送邮件，都是使用`SMTP协议`，而`POP`和`IMAP`则是用户代理从接收方邮件服务器上读取邮件所使用的协议；

### 基于万维网的电子邮件

+ 如谷歌GMail和网易(163)等都提供了万维网邮件服务，这些万维网邮件服务器都带有方便使用的用户代理，并且都使用`IMAP`，用户可以在这种邮件服务器中存放很多的邮件(已读取的、已发送的、已删除的但尚未彻底删除的等等)，注意：电子邮件从`A的浏览器`发送到`网易的邮件服务器`时，不是使用SMTP协议，而是使用`HTTP`协议；从`网易的邮件服务器`发送到`新浪的邮件服务器`时使用的是`SMTP`协议而不是`HTTP`协议；但`B`用浏览器从`新浪邮件服务器`读取`A`发来的邮件时，使用的是`HTTP`协议，而不是使用`POP3或IMAP协议`；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-181.jpg) 
### 通用因特网邮件扩充MIME
#### MIME概述
+ `SMTP`不能传送可执行文件或二进制对象，`SMTP`会拒绝超过一定长度的邮件，因此就提出了`通用因特网邮件扩充MIME`，它的意图是`继续使用原来的邮件格式，但增加了邮件主体的结构，并定义了传送非ASCII码的编码规则`；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-182.jpg) 

|MIME的三部分内容|说明|
|------|------|
|5个新的邮件首部字段|他们可包含在原来的首部中，这些字段提供了有关邮件主体的信息，有的是可选的；MIME-Version：标志MIME的版本，现在的版本号为1.0，若无此行则为英文文本；Content-Description：这是可读字符串，说明此邮件主体是否是图像、音频或视频；Content-Id：邮件的唯一标识符；Content-Transfer-Encoding：在传送时邮件的主体是如何编码的；Content-Type：说明邮件主体的数据类型和子类型|
|定义了许多邮件内容的格式|对多媒体电子邮件的表示方法进行了标准化|
|定义了传送编码|可对任何内容格式进行转换，而不会被邮件系统改变|

#### 内容传送编码Content-Transfer-Encoding

|内容传送编码种类|
|------|
|最简单的编码就是7位ASCII码，而每行不能超过1000个字符，MIME对这种由ASCII码构成的邮件主体不进行任何转换|
|quoted-printable这种编码方法适用于当所传送的数据中只有少量的非ASCII码如汉字|
|对于任意的二进制文件，可用base64编码|

#### 内容类型Content-Type
+ `MIME`标准规定`Content-Type`说明必须含有`两个标识符`，即`内容类型`和`子类型`中间用`/`分开如`Content-Type：image/gif`；
