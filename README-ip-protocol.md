### 网际协议IP
+ 与`IP协议`配套使用的还有三个协议：`地址解析协议ARP(Address Resolution Protocol)`、`网际控制报文协议ICMP(Internet Control Message Protocol)`、`网际组管理协议IGMP(Internet Group Management Protocol)`；

![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-50.jpg)   pic-50.jpg

+ `ARP`画在最下面，因为`IP`经常要使用这个协议，`ICMP`、`IGMP`画在这一层的上部，因为它们要使用`IP`协议；由于`网际协议IP`是用来使互连起来的许多计算机网络能够进行通信，因此`TCP/IP`体系中的网络层常常被称为`网际层`或`IP层`；

### 虚拟互连网络
+ 由于参加互连的计算机网络都使用相同的`网际协议IP`，因此可以把互连以后的计算机网络看成`虚拟互连网络`，所谓虚拟互联网络就是逻辑互连网络，互连起来的各种物理网络的异构性本来是客观存在的，但是利用`IP协议`就可以使这些性能各异的网络在`网络层上看起来好像是一个统一的网络`；这种使用`IP协议`的虚拟互连网络也称为`IP网`；使用`IP网`的好处是：当`IP网`上的主机进行通信时，就好像在一个单个网络上通信一样，它们看不见互连的各网络的具体异构细节；

![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-51.jpg)   pic-51.jpg

### 分类的IP地址
#### IP地址及其表示方法
+ 分类的IP地址：将`IP地址`划分为若干个固定类，每一类地址都由两个固定长度的字段组成，其中第一个字段是`网络号`，它标志`主机(或路由器)`所连接到的网络，一个`网络号`在整个因特网范围内必须是唯一的，第二个字段是`主机号`，它标志`该主机(或路由器)`，一个`IP地址在整个因特网范围内是唯一的`；

![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-52.jpg)   pic-52.jpg
+ 当某个单位申请到一个`IP地址`时，实际上是获得了具有同样`网络号`的一块地址，其中具体的各个`主机号`则由该单位自行分配，只要做到在该单位管辖的范围内无重复的主机号即可；下面是一个`B类IP地址`：`128.11.3.31`、即`10000000 00001011 00000011 00011111`；

#### 常用的三种类别的IP地址

|网络地址类别|说明|
|------|------|
|A类地址|IP地址中的全0表示`这个this`，网络号字段为全0的IP地址是个保留地址，意思是`本网络`，网络号为`127(即01111111)`保留作为本地软件`回环测试`本主机的进程之间的通信之用，全0的主机号字段表示该IP地址是`本主机`所连接到的`单个网络地址`，而全1表示`所有的all`，因此全1的主机号字段表示该网络上的所有主机|
|B类地址|B类地址`128.0.0.0`是不指派的，而可以指派的B类最小网络地址是`128.1.0.0`|
|C类地址|C类地址`192.0.0.0`是不指派的，可以指派的C类最小网络地址是`192.0.1.0`|
### IP地址与硬件地址
+ `物理地址`是`数据链路层`和`物理层`使用的地址，而`IP地址`是`网络层和以上各层`使用的地址；使用`IP地址`的`IP数据报`一旦交给了`数据链路层`，就被封装成了`MAC帧`，`MAC帧`在传送时使用的`源地址`和`目的地址`都是`硬件地址`，这两个`硬件地址`都写在`MAC帧`的首部中；

![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-53.jpg)   pic-53.jpg

+ 在`IP层`抽象的互联网上只能看到`IP数据报`，而且`IP数据报中的目的地址和源地址是不变的`，路由器只根据`目的站的IP地址的网络号`进行路由选择；在局域网的链路层，只能看到`MAC帧`，`MAC`帧在不同网络上传送时，其`MAC帧`首部中的`源地址`和`目的地址`要发生改变；

### 地址解析协议ARP
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-54.jpg)   pic-54.jpg

+ `ARP`协议的用途是`为了从网络层使用的IP地址解析出在数据链路层使用的硬件地址`；`地址解析协议ARP`在`主机ARP高速缓存中应存放一个从IP地址到硬件地址的映射表`，并且这个映射表还经常动态更新(新增或超时删除)，每个主机都设有一个`ARP高速缓存`，里面有`本局域网上`的各主机和路由器的`IP地址到硬件地址的映射表`；`ARP`是解决`同一个局域网上`的主机和路由器的`IP地址`和`硬件地址`的映射问题；

### IP数据报的格式
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-55.jpg)   pic-55.jpg

#### IP数据报首部的固定部分中的各字段

|IP数据报首部的固定部分中的各字段|说明|
|------|------|
|版本|指IP协议的版本，通信双方使用的IP协议的版本必须是一致的；如IPV4、IPV6|
|首部长度|就是固定长度与可变部分长度的总和|
|区分服务|用来获取更好的服务，只有在使用区分服务时，这个字段才起作用，在一般的情况下都不使用这个字段|
|总长度|总长度指首部和数据之和的长度|
|标识|IP软件在存储器中维持一个计数器，每产生一个数据报，计数器就加1，并将此值赋给标识字段|
|标志|占3位，但目前只有两位有意义；标志字段中的最低位记为`MF`，`MF=1`即表示后面`还有分片`的数据报，`MF=0`表示这已是若干数据报片中的最后一个；标志字段中间的一位记为`DF`，意思是`不能分片`，只有当`DF=0`时才允许分片|
|片偏移|片偏移指出：较长的分组在分片后，某片在原分组中的相对位置|
|生存时间|生存时间字段常用的英文缩写是TTL，表明是数据报在网络中的寿命，TTL的意义是指明数据报在因特网中至多可经过多少个路由器|
|协议|协议字段指出此数据报携带的数据是使用何种协议；如`ICMP：1`、`IGMP：2`、`IP：4`、`TCP：6`、`EGP：8`、`IGP：9`、`UDP：17`、`IPV6：41`、`ESP：50`、`OSPF：89`|
|首部校验和|这个字段只检验数据报的首部，但不包括数据部分，检验首部是否出错|
|源地址|源地址|
|目的地址|目的地址|

#### IP数据报首部的可变部分
+ IP首部的可变部分就是一个`选项字段`，选项字段用来支持`排错`、`测量`、`安全`等措施，内容很丰富，此字段的长度可变，最后用全0的填充字段补齐成为4字节的整数倍；
![image](https://github.com/ningbaoqi/ComputerNetWork/blob/master/gif/pic-56.jpg)   pic-56.jpg
